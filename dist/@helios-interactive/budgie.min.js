/*! @helios-interactive/budgie 01-05-2017 */

!function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,d){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c(this,a),this.selector=d,this.options=Object.assign(this.constructor.defaultOptions(),e),this.isNew=!0,this.budgieId=Math.floor(65536*(1+Math.random())),this.items=b;var f=this;this.items.pop=function(){var a=Array.prototype.pop.apply(f.items,arguments);return f.popItem(),a},this.items.push=function(){var a=Array.prototype.push.apply(f.items,arguments);return f.pushItem(),a},this.items.shift=function(){var a=Array.prototype.shift.apply(f.items,arguments);return f.shiftItem(),a},this.items.unshift=function(){var a=Array.prototype.unshift.apply(f.items,arguments);return f.unshiftItem(),a},this.items.splice=function(){var a=Array.prototype.splice.apply(f.items,arguments);return f.updateAllElements(),a},this.start()}return e(a,[{key:"setupContainer",value:function(){var a=this.constructor.getElement(this.selector);a.classList.add("budgie-flex-container-parent"),a.classList.add("budgie-flex-container-parent-"+this.budgieId),this.parentContainer=a;var b=document.createElement("div");b.classList.add("budgie-flex-container"),b.classList.add("budgie-container-"+this.budgieId),a.appendChild(b),this.setCSS(b),this.container=b}},{key:"setupScrollProperties",value:function(){var a=this,b=this.scrollProperty(),c=this.elementMeasurement("budgie-flex-item-"+this.budgieId),d="horizontal"===this.options.direction?c.width:c.height;this.parentContainer[b]=d,this.parentContainer.addEventListener("scroll",function(){a.onScroll(b)})}},{key:"numberLeftWithOddEnding",value:function(){var a="horizontal"===this.options.direction?this.options.numberHigh:this.options.numberWide;return this.items.length%a}},{key:"setCSS",value:function(a){var b=parseInt(window.getComputedStyle(a).width),c=0;document.styleSheets[0].cssRules&&(c=document.styleSheets[0].cssRules.length);var d=this.options.numberHigh>=this.options.numberWide?this.options.numberHigh:this.options.numberWide,e=b/this.options.numberWide/b*100,f=100/this.options.numberHigh;document.styleSheets[0].insertRule(".budgie-flex-item-"+this.budgieId+"{width: "+e+"%; height: "+f+"%;}",c);for(var g=d-1;g>=0;g--)document.styleSheets[0].insertRule(".budgie-flex-item-"+this.budgieId+"--filler-"+g+"{width: "+e*(this.options.numberWide-g)/2+"%; height: "+f*(this.options.numberHigh-g)/2+"%; flex-grow: 1;}",c);var h="horizontal"===this.options.direction?"column":"row";document.styleSheets[0].insertRule(".budgie-container-"+this.budgieId+"{flex-direction: "+h+";}",c),document.styleSheets[0].insertRule(".budgie-flex-container-parent-"+this.budgieId+"{overflow-x: "+("horizontal"===this.options.direction?"scroll":"hidden")+"; overflow-y: "+("vertical"===this.options.direction?"scroll":"hidden")+"}",c)}},{key:"insertItems",value:function(){var a=this;if(this.items.forEach(function(b,c){a.numberLeftWithOddEnding()>0&&a.items.length-a.numberLeftWithOddEnding()===c&&a.container.appendChild(a.newFillerItem()),a.container.appendChild(a.createBudgieDiv(b,c)),a.numberLeftWithOddEnding()>0&&a.items.length===c+1&&a.container.appendChild(a.newFillerItem())}),this.items.length<this.elementsOnScreen()){var b=document.createElement("div");b.classList.add("budgie-flex-item-"+this.budgieId+"--blank"),this.container.appendChild(b)}}},{key:"newFillerItem",value:function(){var a=document.createElement("div");return a.classList.add("budgie-flex-item-"+this.budgieId+"--filler"),a.classList.add("budgie-flex-item-"+this.budgieId+"--filler-"+this.numberLeftWithOddEnding()),a}},{key:"prependStartingItems",value:function(){var a=this,b=this.elementsOnScreen(),c=Array.from(document.querySelectorAll(".budgie-flex-item-"+this.budgieId+":not(.budgie-flex-item-"+this.budgieId+"--duplicate)"));if(this.items.length>b)if(this.numberLeftWithOddEnding()>0)this.container.insertAdjacentElement("afterbegin",this.newFillerItem()),c.slice(c.length-this.numberLeftWithOddEnding(),c.length).reverse().forEach(function(b){var c=b.cloneNode(!0);c.classList.add("budgie-flex-item-"+a.budgieId+"--duplicate"),a.container.insertAdjacentElement("afterbegin",c)}),this.container.insertAdjacentElement("afterbegin",this.newFillerItem());else{var d="horizontal"===this.options.direction?this.options.numberHigh:this.options.numberWide;c.slice(c.length-d,c.length).reverse().forEach(function(b){var c=b.cloneNode(!0);c.classList.add("budgie-flex-item-"+a.budgieId+"--duplicate"),a.container.insertAdjacentElement("afterbegin",c)})}}},{key:"appendEndingItems",value:function(){var a=this,b=this.elementsOnScreen(),c=Array.from(document.querySelectorAll(".budgie-flex-item-"+this.budgieId+":not(.budgie-flex-item-"+this.budgieId+"--duplicate)"));this.items.length>b&&c.slice(0,b).forEach(function(b){var c=b.cloneNode(!0);c.classList.add("budgie-flex-item-"+a.budgieId+"--duplicate"),c.classList.add("budgie-flex-item-"+a.budgieId+"--duplicate-ending"),a.container.insertAdjacentElement("beforeend",c)})}},{key:"elementsOnScreen",value:function(){return parseInt(this.options.numberHigh)*parseInt(this.options.numberWide)}},{key:"pushItem",value:function(){this.addLastItem(),this.updateBeginningAndEndingItems("add"),this.start()}},{key:"popItem",value:function(){this.removeLastItem(),this.updateBeginningAndEndingItems("remove"),this.start()}},{key:"shiftItem",value:function(){this.updateExistingItems(),this.removeLastItem(),this.updateBeginningAndEndingItems("remove"),this.start()}},{key:"unshiftItem",value:function(){this.updateExistingItems(),this.addLastItem(),this.updateBeginningAndEndingItems("add"),this.start()}},{key:"updateAllElements",value:function(){var a=document.querySelectorAll(".budgie-flex-item-"+this.budgieId+":not(.budgie-flex-item-"+this.budgieId+"--duplicate)").length;if(this.items.length>a){for(var b=a;b<this.items.length;b++)this.addLastItem(b,b-1);this.updateBeginningAndEndingItems("add",!0)}else if(this.items.length<a){for(var c=a;c>this.items.length;c--)this.removeLastItem(c-1);this.updateBeginningAndEndingItems("remove",!0)}this.updateExistingItems(),this.start()}},{key:"removeLastItem",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.items.length,b=document.getElementsByClassName("budgie-"+this.budgieId+"-"+a);Array.from(b).forEach(function(a){a.parentNode.removeChild(a)})}},{key:"addLastItem",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.items.length-1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.items.length-2,c=document.getElementsByClassName("budgie-"+this.budgieId+"-"+b);!c.length>0&&(c=document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--blank"));var d=this.createBudgieDiv(this.items[a],a),e=0;c.length>1&&(e=1),c[e].parentNode.insertBefore(d,c[e].nextSibling)}},{key:"createBudgieDiv",value:function(a,b){var c=document.createElement("div");c.classList.add("budgie-flex-item"),c.classList.add("budgie-flex-item-"+this.budgieId),c.classList.add("budgie-"+this.budgieId+"-"+b);var d=this.createItemAsElement(a);return c.innerHTML=d.outerHTML,c}},{key:"createItemAsElement",value:function(a,b){if("object"===(void 0===a?"undefined":d(a)))return a;if("string"!=typeof a)throw new Error("Only DOM Elements and strings are accepted as budgie items");var c=a.match(/\.{1}\w*$/);c&&(c=c[0].substr(1));var e=["jpg","gif","png"],f=["mp4","ogg","webm"];console.log(a,c);var g=void 0;if(e.includes(c)?(g=document.createElement("img"),g.src=a):f.includes(c)&&(g=document.createElement("video"),g.src=a),!g)throw new Error("Extension of: "+c+" is not supported.");return g}},{key:"updateExistingItems",value:function(){var a=this;this.items.forEach(function(b,c){Array.from(document.getElementsByClassName("budgie-"+a.budgieId+"-"+c)).forEach(function(c){var d=a.createItemAsElement(b).outerHTML;c.innerHTML!==d&&(c.innerHTML=d)})})}},{key:"updateBeginningAndEndingItems",value:function(a){this.updateListStart(),this.updateListEnding(a)}},{key:"updateListStart",value:function(){var a=this,b=void 0;b=this.numberLeftWithOddEnding()>0?this.numberLeftWithOddEnding():"horizontal"===this.options.direction?this.options.numberHigh:this.options.numberWide;var c=Array.from(document.querySelectorAll(".budgie-flex-item-"+this.budgieId+":not(.budgie-flex-item-"+this.budgieId+"--duplicate)")),d=Array.from(document.querySelectorAll(".budgie-flex-item-"+this.budgieId+".budgie-flex-item-"+this.budgieId+"--duplicate")),e=d.slice(0,d.length-this.elementsOnScreen()),f=c.slice(c.length-b,c.length),g=c[0];if(console.log("Updating List Start",b,f,e,g),e.length>f.length){var h=e.length-f.length;console.log("Need to remove",h);for(var i=0;i<h;i+=1)console.log("removing elements",i,e[i]),e[i].parentNode.removeChild(e[i]),e.shift()}this.items.length<=this.elementsOnScreen()||f.forEach(function(b,c){var d=b.cloneNode(!0);d.classList.add("budgie-flex-item-"+a.budgieId+"--duplicate"),e[c]?(console.log("replacing existing"),e[c].outerHTML=d.outerHTML):(console.log("adding new"),g.parentNode.insertBefore(d,g))})}},{key:"updateListEnding",value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=void 0;if("remove"===a)d=1;else{if("add"!==a)throw new Error("Only 'add' and 'remove' are supported arguments");d=-1}if(c&&Array.from(document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--filler")).forEach(function(a){return a.parentNode.removeChild(a)}),this.numberLeftWithOddEnding()>0)if(0===document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--filler").length){var e=Array.from(document.getElementsByClassName("budgie-"+this.budgieId+"-"+(this.items.length-1))),f=Array.from(document.getElementsByClassName("budgie-"+this.budgieId+"-"+(this.items.length-this.numberLeftWithOddEnding())));e.forEach(function(a){a.parentNode.insertBefore(b.newFillerItem(),a.nextSibling)}),f.forEach(function(a){a.parentNode.insertBefore(b.newFillerItem(),a)})}else Array.from(document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--filler")).forEach(function(a){a.classList.remove("budgie-flex-item-"+b.budgieId+"--filler-"+(b.numberLeftWithOddEnding()+d)),a.classList.add("budgie-flex-item-"+b.budgieId+"--filler-"+b.numberLeftWithOddEnding())});else Array.from(document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--filler")).forEach(function(a){return a.parentNode.removeChild(a)});if(this.items.length<=this.elementsOnScreen()&&(Array.from(document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--duplicate")).forEach(function(a){return a.parentNode.removeChild(a)}),0===document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--blank").length)){var g=document.createElement("div");g.classList.add("budgie-flex-item-"+this.budgieId+"--blank"),this.container.appendChild(g)}this.items.length>this.elementsOnScreen()&&0===document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--duplicate-ending").length&&(this.appendEndingItems(),Array.from(document.getElementsByClassName("budgie-flex-item-"+this.budgieId+"--blank")).forEach(function(a){return a.parentNode.removeChild(a)}))}},{key:"elementMeasurement",value:function(a){var b={};return b.height=parseFloat(window.getComputedStyle(document.getElementsByClassName(a)[0]).height),b.width=parseFloat(window.getComputedStyle(document.getElementsByClassName(a)[0]).width),b}},{key:"scrollSizeMeasurement",value:function(){switch(this.options.direction){case"vertical":return this.elementMeasurement("budgie-flex-item-"+this.budgieId).height*Math.ceil(this.items.length/this.options.numberWide);case"horizontal":return this.elementMeasurement("budgie-flex-item-"+this.budgieId).width*Math.ceil(this.items.length/this.options.numberHigh)}}},{key:"onScroll",value:function(a){var b=this.scrollSizeMeasurement(),c=this.elementMeasurement("budgie-flex-item-"+this.budgieId),d=Math.floor("horizontal"===this.options.direction?c.width:c.height);this.parentContainer[a]>=b+d?this.parentContainer[a]=d:this.parentContainer[a]<=0&&(this.parentContainer[a]=b)}},{key:"scrollProperty",value:function(){return"vertical"===this.options.direction?"scrollTop":"horizontal"===this.options.direction?"scrollLeft":void 0}},{key:"startAnimation",value:function(){var a=this,b=this.options.fps,c=this.scrollProperty(),d=this.container.parentElement,e=void 0,f=this.elementMeasurement("budgie-container-"+this.budgieId),g="horizontal"===this.options.direction?f.width:f.height,h=Math.ceil(g/this.options.secondsOnPage/b);this.stop(),this.items.length>this.elementsOnScreen()?this.interval=setInterval(function(){var b=a.scrollProperty();e=d[b],a.options.inverted?e+=h:e-=h,d[b]=e},1e3/b):d[c]=0}},{key:"start",value:function(){this.isNew&&(this.setupContainer(),this.insertItems(),this.options.infiniteScroll&&(this.appendEndingItems(),this.prependStartingItems(),this.setupScrollProperties())),this.options.autoScroll&&this.startAnimation(),this.isNew=!1}},{key:"stop",value:function(){return!!this.interval&&(window.clearInterval(this.interval),!0)}},{key:"remove",value:function(){this.stop(),this.container.parentElement.classList.remove("budgie-flex-container-parent-"+this.budgieId),this.container.parentElement.removeChild(this.container)}},{key:"changeInversion",value:function(){this.options.inverted=!this.options.inverted}}],[{key:"defaultOptions",value:function(){return{numberHigh:1,numberWide:1,direction:"vertical",secondsOnPage:1,inverted:!1,autoScroll:!0,fps:60,infiniteScroll:!0}}},{key:"getElement",value:function(a){if("object"===(void 0===a?"undefined":d(a)))return a;switch(a.substring(0,1)){case".":return document.getElementsByClassName(a.substring(1))[0];case"#":return document.getElementById(a.substring(1));default:throw new Error("The selector must be a class or id, prepended by the identifier ('.'/'#')")}}}]),a}();void 0!==b&&(b.Budgie=f),b.true=a}({},function(){return this}());
//# sourceMappingURL=budgie.es6.map